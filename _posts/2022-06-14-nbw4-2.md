---
title:  "ë‚´ì¼ë°°ì›€ë‹¨ Web4.2"
categories: SpartaWeb
toc: true
toc_sticky: true
sidebar:
    nav: docs
---

# [ì›¹ê°œë°œ ì¢…í•©ë°˜] 4ì£¼ 1ì¼ì°¨ ê°œë°œì¼ì§€(4ì£¼ 6-9ê°•)

<br>

## ğŸ’»TIL Web.402

## 1. 'ëª¨ë‘ì˜ ì±…ë¦¬ë·°' í”„ë¡œì íŠ¸

### 1) ë¼ˆëŒ€ ì¤€ë¹„í•˜ê¸°

`bookreview` í´ë”ì— `templates`, `static` í´ë”ì™€ `app.py` íŒŒì¼ì„ ìƒì„±í•œ í›„, `templates` í´ë”ì— `index.html` íŒŒì¼ê¹Œì§€ ë§Œë“ ë‹¤. ë˜í•œ, `app.py`ì™€ `index.html` íŒŒì¼ì— ì•„ë˜ ì‹œì‘ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ëŠ”ë‹¤.

```py
from flask import Flask, render_template, jsonify, request
app = Flask(__name__)

from pymongo import MongoClient
client = MongoClient('localhost', 27017)
db = client.dbsparta

## HTMLì„ ì£¼ëŠ” ë¶€ë¶„
@app.route('/')
def home():
  return render_template('index.html')

## API ì—­í• ì„ í•˜ëŠ” ë¶€ë¶„
@app.route('/review', methods=['POST'])
def write_review():
  sample_receive = request.form['sample_give']
  print(sample_receive)
  return jsonify({'msg': 'ì´ ìš”ì²­ì€ POST!'})


@app.route('/review', methods=['GET'])
def read_reviews():
  sample_receive = request.args.get('sample_give')
  print(sample_receive)
  return jsonify({'msg': 'ì´ ìš”ì²­ì€ GET!'})


if __name__ == '__main__':
  app.run('0.0.0.0', port=5000, debug=True)
```
<br>

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- Webpage Title -->
    <title>ëª¨ë‘ì˜ ì±…ë¦¬ë·° | ìŠ¤íŒŒë¥´íƒ€ì½”ë”©í´ëŸ½</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"></script>

    <!-- êµ¬ê¸€í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css?family=Do+Hyeon&display=swap" rel="stylesheet">

    <script type="text/javascript">

      $(document).ready(function() {
        showReview();
      });

      function makeReview() {
        $.ajax({
          type: "POST",
          url: "/review",
          data: {sample_give:'ìƒ˜í”Œë°ì´í„°'},
          success: function (response) {
            alert(response["msg"]);
            window.location.reload();
          }
        })
      }

      function showReview() {
        $.ajax({
          type: "GET",
          url: "/review?sample_give=ìƒ˜í”Œë°ì´í„°",
          data: {},
          success: function (response) {
            alert(response["msg"]);
          }
        })
      }
    </script>

    <style type="text/css">
      * {
        font-family: "Do Hyeon", sans-serif;
      }

      h1,
      h5 {
        display: inline;
      }

      .info {
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .review {
        text-align: center;
      }

      .reviews {
        margin-top: 100px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <img src="https://i.pinimg.com/originals/71/b8/f0/71b8f0548e938fbffb62e1e69b834f9e.jpg"
      class="img-fluid" alt="Responsive image">
      <div class="info">
        <h1>ì½ì€ ì±…ì— ëŒ€í•´ ë§ì”€í•´ì£¼ì„¸ìš”.</h1>
        <p>ë‹¤ë¥¸ ì‚¬ëŒì„ ìœ„í•´ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”! ë‹¤ ê°™ì´ ì¢‹ì€ ì±…ì„ ì½ëŠ”ë‹¤ë©´ ë‹¤ í•¨ê»˜ í–‰ë³µí•´ì§ˆ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”?</p>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">ì œëª©</span>
          </div>
          <input type="text" class="form-control" id="title">
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">ì €ì</span>
          </div>
          <input type="text" class="form-control" id="author">
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">ë¦¬ë·°</span>
          </div>
          <textarea class="form-control" id="bookReview"
                    cols="30"
                    rows="5" placeholder="140ìê¹Œì§€ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."></textarea>
        </div>
        <div class="review">
          <button onclick="makeReview()" type="button" class="btn btn-primary">ë¦¬ë·° ì‘ì„±í•˜ê¸°</button>
        </div>
      </div>
      <div class="reviews">
        <table class="table">
          <thead>
          <tr>
            <th scope="col">ì œëª©</th>
            <th scope="col">ì €ì</th>
            <th scope="col">ë¦¬ë·°</th>
          </tr>
          </thead>
          <tbody id="reviews-box">
          <tr>
            <td>ì™•ì´ˆë³´ 8ì£¼ ì½”ë”©</td>
            <td>ê¹€ë¥´íƒ„</td>
            <td>ì—­ì‹œ ì™•ì´ˆë³´ ì½”ë”©êµìœ¡ì˜ ëª…ê°€ë‹µêµ°ìš”. ë”°ë¼í•˜ë‹¤ë³´ë‹ˆ ëˆˆ ê¹œì§í•  ì‚¬ì´ì— 8ì£¼ê°€ ì§€ë‚¬ìŠµë‹ˆë‹¤.</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
```

<br>

### 2) ë¦¬ë·° ì €ì¥í•˜ê¸°(POST)

> **API ë§Œë“¤ê³  ì‚¬ìš©í•˜ê¸° ìˆœì„œ!**<br><br>â‘  í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ì—°ê²° í™•ì¸í•˜ê¸°<br>â‘¡ ì„œë²„ë¶€í„° ë§Œë“¤ê¸°<br>â‘¢ í´ë¼ì´ì–¸íŠ¸ ë§Œë“¤ê¸°<br>â‘£ ì™„ì„± í™•ì¸í•˜ê¸°


**â‘  í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ì—°ê²° í™•ì¸í•˜ê¸°**

```py
# app.py
@app.route('/review', methods=['POST'])
def write_review():
  sample_receive = request.form['sample_give']
  print(sample_receive)
  return jsonify({'msg': 'ì´ ìš”ì²­ì€ POST!'})
```
ì„œë²„ ìª½ì— ë§Œë“¤ì–´ë‘” ì°½êµ¬ëŠ” ìœ„ì™€ ê°™ë‹¤. '/review'ë¼ëŠ” url ì£¼ì†Œë¡œ POST ìš”ì²­ì„ ë°›ìœ¼ë©°, `sample_give`ë¼ëŠ” ë³€ìˆ˜ ì´ë¦„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°›ê³  ìˆë‹¤. ë°›ì€ ë°ì´í„°ë¥¼ `sample_receive` ë³€ìˆ˜ì— ì €ì¥í•´ ì¶œë ¥í•˜ê³ , 'ì´ ìš”ì²­ì€ POST!'ë¼ëŠ” ë©”ì„¸ì§€ë¥¼ ë‚´ë ¤ì¤€ë‹¤.

<br>

```html
<script>
  function makeReview() {
    $.ajax({
      type: "POST",
      url: "/review",
      data: {sample_give:'ìƒ˜í”Œë°ì´í„°'},
      success: function (response) {
        alert(response["msg"]);
        window.location.reload();
      }
    })
  }
</script>

...

<body>
  <div class="review">
    <button onclick="makeReview()" type="button" class="btn btn-primary">ë¦¬ë·° ì‘ì„±í•˜ê¸°</button>
  </div>
</body>
```

í´ë¼ì´ì–¸íŠ¸ ìª½ìœ¼ë¡œ ê°€ë³´ë©´, ì´ `sample_give` ë³€ìˆ˜ëŠ” `makeReview`ë¼ëŠ” í•¨ìˆ˜ì—ì„œ ë¶ˆë¦¬ê³  ìˆë‹¤. `data`ì—ì„œ 'ìƒ˜í”Œë°ì´í„°'ë¼ëŠ” ë°ì´í„°ë¥¼ ê°€ì§€ê³  ê°€ëŠ” ëª¨ìŠµë„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ ë°ì´í„°ë¥¼ ì˜ ê°€ì§€ê³  ê°”ìœ¼ë©´ `response`ë¡œ `app.py`ì—ì„œ `write_review` í•¨ìˆ˜ê°€ ë°˜í™˜í•œ `{'msg': 'ì´ ìš”ì²­ì€ POST!'}`ê°€ ë„˜ì–´ì˜¤ê²Œ ëœë‹¤. ë‹¤ì‹œ ìœ„ ì½”ë“œë¥¼ ë³´ë©´, `response["msg"]`ë¥¼ `alert` ì°½ìœ¼ë¡œ ë„ìš°ë¯€ë¡œ 'ì´ ìš”ì²­ì€ POST!' ë©”ì„¸ì§€ê°€ ëœ¨ê²Œ ëœë‹¤. HTML ì½”ë“œ ì•„ë˜ìª½ì„ ë³´ë©´, ì´ `makeReview()` í•¨ìˆ˜ëŠ” 'ë¦¬ë·° ì‘ì„±í•˜ê¸°' ë²„íŠ¼ì— ë¶™ì–´ ìˆë‹¤. ì¦‰ ì´ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ Ajax ì½œì´ ë™ì‘í•œë‹¤ëŠ” ì˜ë¯¸ë‹¤. ì´ë ‡ê²Œ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ë˜ì—ˆë‹¤.

<br>

**â‘¡ ì„œë²„ë¶€í„° ë§Œë“¤ê¸°**

ì´ì œ ì„œë²„ ìª½ì„ ì‚´í´ë³´ì. ì…ë ¥ ì°½ì—ì„œëŠ” ì œëª©, ì €ì, ë¦¬ë·° ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ í…Œë‹ˆ í•´ë‹¹ ë°ì´í„°ë¥¼ ë°›ì•„ì„œ DBì— ì €ì¥í•´ ì£¼ì–´ì•¼ í•œë‹¤. ìœ„ì—ì„œ `request.form`ì„ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë°›ì•˜ìœ¼ë‹ˆ ì´ë¥¼ ê·¸ëŒ€ë¡œ ì‘ìš©í•˜ë©´ ëœë‹¤.
<br>

ë°ì´í„°ë¥¼ ë°›ì•„ ì´ë¥¼ DBì— ì €ì¥í•˜ë ¤ë©´ pymongoì—ì„œì˜ ë°ì´í„° ì €ì¥(insert), íƒìƒ‰(find), ì—…ë°ì´íŠ¸(update), ì‚­ì œ(delete)ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤. ì…ë ¥ë°›ì€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì´ë¯€ë¡œ `insert`ë¥¼ ì´ìš©í•œë‹¤. ì˜ˆì‹œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤. `insert` ë¶€ë¶„ì„ ë³´ë©´ `doc`ë¼ëŠ” ë”•ì…”ë„ˆë¦¬ë¥¼ ë§Œë“  í›„ ì´ë¥¼ `users`ë¼ëŠ” ì»¬ë ‰ì…˜ì— ì €ì¥í•˜ê³  ìˆë‹¤.

```py
# ì €ì¥ - ì˜ˆì‹œ
doc = {'name':'bobby','age':21}
db.users.insert_one(doc)

# í•œ ê°œ ì°¾ê¸° - ì˜ˆì‹œ
user = db.users.find_one({'name':'bobby'})

# ì—¬ëŸ¬ê°œ ì°¾ê¸° - ì˜ˆì‹œ ( _id ê°’ì€ ì œì™¸í•˜ê³  ì¶œë ¥)
same_ages = list(db.users.find({'age':21},{'_id':False}))

# ë°”ê¾¸ê¸° - ì˜ˆì‹œ
db.users.update_one({'name':'bobby'},{'$set':{'age':19}})

# ì§€ìš°ê¸° - ì˜ˆì‹œ
db.users.delete_one({'name':'bobby'})
```

<br>

ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì…ë ¥ë°›ì€ ë°ì´í„° ë³€ìˆ˜ë¥¼ ì†ì„±ê°’ìœ¼ë¡œ ê°–ëŠ” ë”•ì…”ë„ˆë¦¬ ë³€ìˆ˜ë¥¼ ë§Œë“¤ê³ , ì´ë¥¼ `bookreview` ì»¬ë ‰ì…˜ì— ì €ì¥í•œë‹¤.

```py
# app.py
@app.route('/review', methods=['POST'])
def write_review():
  title_receive = request.form['title_give']
  author_receive = request.form['author_give']
  review_receive = request.form['review_give']

  doc = {
    'title': title_receive,
    'author': author_receive,
    'review': review_receive 
  }
  db.bookreview.insert_one(doc)

  print(sample_receive)
  return jsonify({'msg': 'ì €ì¥ ì™„ë£Œ!'})
```

<br>

**â‘¢ í´ë¼ì´ì–¸íŠ¸ ë§Œë“¤ê¸°**

ì„œë²„ì—ì„œ ê°ê° ì œëª©, ì €ì, ë¦¬ë·° ë°ì´í„°ë¥¼ ë°›ì•„ DBì— ì €ì¥í•œë‹¤ë©´, í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œëŠ” ê° ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì„œë²„ë¡œ ë³´ë‚´ì¤˜ì•¼ í•œë‹¤. jQueryì˜ `val()`ì„ ì‚¬ìš©í•˜ë©´ input ë°•ìŠ¤ì˜ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì•„ë˜ì™€ ê°™ì´ ë³€ìˆ˜ë¥¼ ì„¤ì •í•œ í›„ Ajaxë¡œ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ë³´ë‚¸ë‹¤.

```js
function makeReview() {
  // ê° input ë°•ìŠ¤ì˜ ì•„ì´ë”” ì…ë ¥
  let title = $('#title').val()
  let author = $('#author').val()
  let review = $('#bookReview').val()
  $.ajax({
    type: "POST",
    url: "/review",
    data: {
      title_give: title,
      author_give: author,
      review_give: review
    },
    success: function (response) {
      alert(response["msg"]);
      // ìƒˆë¡œê³ ì¹¨(refresh)
      window.location.reload();
    }
  })
}
```

<br>

**â‘£ ì™„ì„± í™•ì¸í•˜ê¸°**

<figure class="half">
  <a href="../../assets/images/w04_breview01.jpg"><img src="../../assets/images/w04_breview01.jpg"></a>
  <a href="../../assets/images/w04_breview02.jpg"><img src="../../assets/images/w04_breview02.jpg"></a>
</figure>
<br>

ì•„ì§ ì“°ì—¬ì§„ ë¦¬ë·°ë¥¼ í˜ì´ì§€ì—ì„œ í™•ì¸í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, ë°›ì€ ë°ì´í„°ê°€ DBì— ì €ì¥ëœ ëª¨ìŠµì„ Robo 3Tì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br>

### 2) ë¦¬ë·° ë³´ì—¬ì£¼ê¸°(GET)

GET ìš”ì²­ë„ POST ìš”ì²­ê³¼ ë§Œë“œëŠ” ë°©ë²•ì€ ë™ì¼í•˜ë‹¤. 

**â‘  í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ì—°ê²° í™•ì¸í•˜ê¸°**
