---
title:  "내일배움단 Web4.2"
categories: SpartaWeb
toc: true
toc_sticky: true
sidebar:
    nav: docs
---

# [웹개발 종합반] 4주 1일차 개발일지(4주 6-9강)

<br>

## 💻TIL Web.402

## 1. '모두의 책리뷰' 프로젝트

### 1) 뼈대 준비하기

`bookreview` 폴더에 `templates`, `static` 폴더와 `app.py` 파일을 생성한 후, `templates` 폴더에 `index.html` 파일까지 만든다. 또한, `app.py`와 `index.html` 파일에 아래 시작 코드를 붙여넣는다.

```py
from flask import Flask, render_template, jsonify, request
app = Flask(__name__)

from pymongo import MongoClient
client = MongoClient('localhost', 27017)
db = client.dbsparta

## HTML을 주는 부분
@app.route('/')
def home():
  return render_template('index.html')

## API 역할을 하는 부분
@app.route('/review', methods=['POST'])
def write_review():
  sample_receive = request.form['sample_give']
  print(sample_receive)
  return jsonify({'msg': '이 요청은 POST!'})


@app.route('/review', methods=['GET'])
def read_reviews():
  sample_receive = request.args.get('sample_give')
  print(sample_receive)
  return jsonify({'msg': '이 요청은 GET!'})


if __name__ == '__main__':
  app.run('0.0.0.0', port=5000, debug=True)
```
<br>

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- Webpage Title -->
    <title>모두의 책리뷰 | 스파르타코딩클럽</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"></script>

    <!-- 구글폰트 -->
    <link href="https://fonts.googleapis.com/css?family=Do+Hyeon&display=swap" rel="stylesheet">

    <script type="text/javascript">

      $(document).ready(function() {
        showReview();
      });

      function makeReview() {
        $.ajax({
          type: "POST",
          url: "/review",
          data: {sample_give:'샘플데이터'},
          success: function (response) {
            alert(response["msg"]);
            window.location.reload();
          }
        })
      }

      function showReview() {
        $.ajax({
          type: "GET",
          url: "/review?sample_give=샘플데이터",
          data: {},
          success: function (response) {
            alert(response["msg"]);
          }
        })
      }
    </script>

    <style type="text/css">
      * {
        font-family: "Do Hyeon", sans-serif;
      }

      h1,
      h5 {
        display: inline;
      }

      .info {
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .review {
        text-align: center;
      }

      .reviews {
        margin-top: 100px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <img src="https://i.pinimg.com/originals/71/b8/f0/71b8f0548e938fbffb62e1e69b834f9e.jpg"
      class="img-fluid" alt="Responsive image">
      <div class="info">
        <h1>읽은 책에 대해 말씀해주세요.</h1>
        <p>다른 사람을 위해 리뷰를 남겨주세요! 다 같이 좋은 책을 읽는다면 다 함께 행복해질 수 있지 않을까요?</p>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">제목</span>
          </div>
          <input type="text" class="form-control" id="title">
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">저자</span>
          </div>
          <input type="text" class="form-control" id="author">
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text">리뷰</span>
          </div>
          <textarea class="form-control" id="bookReview"
                    cols="30"
                    rows="5" placeholder="140자까지 입력할 수 있습니다."></textarea>
        </div>
        <div class="review">
          <button onclick="makeReview()" type="button" class="btn btn-primary">리뷰 작성하기</button>
        </div>
      </div>
      <div class="reviews">
        <table class="table">
          <thead>
          <tr>
            <th scope="col">제목</th>
            <th scope="col">저자</th>
            <th scope="col">리뷰</th>
          </tr>
          </thead>
          <tbody id="reviews-box">
          <tr>
            <td>왕초보 8주 코딩</td>
            <td>김르탄</td>
            <td>역시 왕초보 코딩교육의 명가답군요. 따라하다보니 눈 깜짝할 사이에 8주가 지났습니다.</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
```

<br>

### 2) 리뷰 저장하기(POST)

> **API 만들고 사용하기 순서!**<br><br>① 클라이언트/서버 연결 확인하기<br>② 서버부터 만들기<br>③ 클라이언트 만들기<br>④ 완성 확인하기


**① 클라이언트/서버 연결 확인하기**

```py
# app.py
@app.route('/review', methods=['POST'])
def write_review():
  sample_receive = request.form['sample_give']
  print(sample_receive)
  return jsonify({'msg': '이 요청은 POST!'})
```
서버 쪽에 만들어둔 창구는 위와 같다. '/review'라는 url 주소로 POST 요청을 받으며, `sample_give`라는 변수 이름으로 데이터를 받고 있다. 받은 데이터를 `sample_receive` 변수에 저장해 출력하고, '이 요청은 POST!'라는 메세지를 내려준다.

<br>

```html
<script>
  function makeReview() {
    $.ajax({
      type: "POST",
      url: "/review",
      data: {sample_give:'샘플데이터'},
      success: function (response) {
        alert(response["msg"]);
        window.location.reload();
      }
    })
  }
</script>

...

<body>
  <div class="review">
    <button onclick="makeReview()" type="button" class="btn btn-primary">리뷰 작성하기</button>
  </div>
</body>
```

클라이언트 쪽으로 가보면, 이 `sample_give` 변수는 `makeReview`라는 함수에서 불리고 있다. `data`에서 '샘플데이터'라는 데이터를 가지고 가는 모습도 볼 수 있다. 이렇게 데이터를 잘 가지고 갔으면 `response`로 `app.py`에서 `write_review` 함수가 반환한 `{'msg': '이 요청은 POST!'}`가 넘어오게 된다. 다시 위 코드를 보면, `response["msg"]`를 `alert` 창으로 띄우므로 '이 요청은 POST!' 메세지가 뜨게 된다. HTML 코드 아래쪽을 보면, 이 `makeReview()` 함수는 '리뷰 작성하기' 버튼에 붙어 있다. 즉 이 버튼을 누를 때마다 Ajax 콜이 동작한다는 의미다. 이렇게 서버와 클라이언트가 연결되었다.

<br>

**② 서버부터 만들기**

이제 서버 쪽을 살펴보자. 입력 창에서는 제목, 저자, 리뷰 데이터가 들어올 테니 해당 데이터를 받아서 DB에 저장해 주어야 한다. 위에서 `request.form`을 사용해 데이터를 받았으니 이를 그대로 응용하면 된다.
<br>

데이터를 받아 이를 DB에 저장하려면 pymongo에서의 데이터 저장(insert), 탐색(find), 업데이트(update), 삭제(delete)를 이용하면 된다. 입력받은 데이터를 저장하는 것이므로 `insert`를 이용한다. 예시 코드는 아래와 같다. `insert` 부분을 보면 `doc`라는 딕셔너리를 만든 후 이를 `users`라는 컬렉션에 저장하고 있다.

```py
# 저장 - 예시
doc = {'name':'bobby','age':21}
db.users.insert_one(doc)

# 한 개 찾기 - 예시
user = db.users.find_one({'name':'bobby'})

# 여러개 찾기 - 예시 ( _id 값은 제외하고 출력)
same_ages = list(db.users.find({'age':21},{'_id':False}))

# 바꾸기 - 예시
db.users.update_one({'name':'bobby'},{'$set':{'age':19}})

# 지우기 - 예시
db.users.delete_one({'name':'bobby'})
```

<br>

같은 방식으로 입력받은 데이터 변수를 속성값으로 갖는 딕셔너리 변수를 만들고, 이를 `bookreview` 컬렉션에 저장한다.

```py
# app.py
@app.route('/review', methods=['POST'])
def write_review():
  title_receive = request.form['title_give']
  author_receive = request.form['author_give']
  review_receive = request.form['review_give']

  doc = {
    'title': title_receive,
    'author': author_receive,
    'review': review_receive 
  }
  db.bookreview.insert_one(doc)

  print(sample_receive)
  return jsonify({'msg': '저장 완료!'})
```

<br>

**③ 클라이언트 만들기**

서버에서 각각 제목, 저자, 리뷰 데이터를 받아 DB에 저장한다면, 클라이언트 쪽에서는 각 데이터를 가져와서 서버로 보내줘야 한다. jQuery의 `val()`을 사용하면 input 박스의 값을 가져올 수 있으므로, 아래와 같이 변수를 설정한 후 Ajax로 데이터를 서버로 보낸다.

```js
function makeReview() {
  // 각 input 박스의 아이디 입력
  let title = $('#title').val()
  let author = $('#author').val()
  let review = $('#bookReview').val()
  $.ajax({
    type: "POST",
    url: "/review",
    data: {
      title_give: title,
      author_give: author,
      review_give: review
    },
    success: function (response) {
      alert(response["msg"]);
      // 새로고침(refresh)
      window.location.reload();
    }
  })
}
```

<br>

**④ 완성 확인하기**

<figure class="half">
  <a href="../../assets/images/w04_breview01.jpg"><img src="../../assets/images/w04_breview01.jpg"></a>
  <a href="../../assets/images/w04_breview02.jpg"><img src="../../assets/images/w04_breview02.jpg"></a>
</figure>
<br>

아직 쓰여진 리뷰를 페이지에서 확인할 수는 없지만, 받은 데이터가 DB에 저장된 모습을 Robo 3T에서 확인할 수 있다.

<br>

### 2) 리뷰 보여주기(GET)

GET 요청도 POST 요청과 만드는 방법은 동일하다. 

**① 클라이언트/서버 연결 확인하기**
